<mxfile host="app.diagrams.net" modified="2022-01-02T04:15:49.300Z" agent="5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.101 Safari/537.36" etag="zc8c9CcvrYPle9OkIYj0" version="16.1.2" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="906" dy="1930" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="dQtFD-pFaniCj-32BVzp-19" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="180" y="400" width="690" height="340" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-18" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="180" y="-10" width="690" height="350" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-3" target="dQtFD-pFaniCj-32BVzp-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="parser" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="249" y="147" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="dQtFD-pFaniCj-32BVzp-0" target="WIyWlLk6GJQsqaUBKTNV-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-0" value="lexer" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="249" y="26" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="dQtFD-pFaniCj-32BVzp-1" target="dQtFD-pFaniCj-32BVzp-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-1" value="code_genertor" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="249" y="263" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="dQtFD-pFaniCj-32BVzp-2" target="dQtFD-pFaniCj-32BVzp-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-2" value="Load()&lt;br&gt;vm/api_call.go" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="249" y="434" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-11" value="Token is a string literal, reference to NextToken() in lex_lexer.go&lt;br&gt;Token kind defined in lex_token.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="309" y="96" width="351" height="30" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-12" value="Block&lt;br&gt;defined in parse_block.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="309" y="206" width="151" height="30" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-14" value="FuncProto&lt;br&gt;defined in binary_chunk.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="309" y="350" width="151" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="dQtFD-pFaniCj-32BVzp-16" target="3L58eqj6yo-zojaCWtl0-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-16" value="callLuaClosure()&lt;br&gt;vm/api_call.go" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="249" y="545" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="dQtFD-pFaniCj-32BVzp-21" value="closure&lt;br&gt;defined in closure.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="309" y="490" width="151" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-2" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;runLuaClosure()&lt;br&gt;vm/api_call.go&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="249" y="650" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-4" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;Create a temp stack for calling closure, initialize the temp stack.&lt;/div&gt;&lt;div&gt;Push the temp stack to the state, the current stack will be replaced by the temp stack.&lt;/div&gt;&lt;div&gt;Run the closure on the current stack.&lt;/div&gt;&lt;div&gt;Pop the temp stack from the state, the current stack will be restored.&lt;/div&gt;&lt;div&gt;Get the result from the temp stack, and push the result to the current stack.&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="380" y="645" width="460" height="50" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-8" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px&quot;&gt;&lt;span style=&quot;color: #008000&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="380" y="730" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-9" value="newLuaStack&lt;br&gt;defined in lua_stack.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="309" y="600" width="151" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-10" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color: #267f99&quot;&gt;funcInfo&lt;/span&gt; &lt;span style=&quot;color: #0000ff&quot;&gt;struct&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;    parent    *funcInfo              &lt;span style=&quot;color: #008000&quot;&gt;// the outside scope of the fuction.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    subFuncs  []*funcInfo            &lt;span style=&quot;color: #008000&quot;&gt;// sub functions in this function.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    usedRegs  &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// the amount of registers which is being used.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    maxRegs   &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// the maxium amount of registers.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    scopeLv   &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// scope level.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    locVars   []*locVarInfo          &lt;span style=&quot;color: #008000&quot;&gt;// local variables array&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    locNames  &lt;span style=&quot;color: #0000ff&quot;&gt;map&lt;/span&gt;[&lt;span style=&quot;color: #267f99&quot;&gt;string&lt;/span&gt;]*locVarInfo &lt;span style=&quot;color: #008000&quot;&gt;// The mapping from local variable name to local variable information.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    upvalues  &lt;span style=&quot;color: #0000ff&quot;&gt;map&lt;/span&gt;[&lt;span style=&quot;color: #267f99&quot;&gt;string&lt;/span&gt;]upvalInfo   &lt;span style=&quot;color: #008000&quot;&gt;// The mapping from upvalue name to upvalue information.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    constants &lt;span style=&quot;color: #0000ff&quot;&gt;map&lt;/span&gt;[&lt;span style=&quot;color: #0000ff&quot;&gt;interface&lt;/span&gt;{}]&lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;    &lt;span style=&quot;color: #008000&quot;&gt;// Constant table store variables in the function body. The types of variable are: nil, bool, digit, string.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    breaks    [][]&lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                &lt;span style=&quot;color: #008000&quot;&gt;// &#39;break&#39; is used in for, repeat, while sentences.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    insts     []&lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt;               &lt;span style=&quot;color: #008000&quot;&gt;// Store byte code.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    lineNums  []&lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt;               &lt;span style=&quot;color: #008000&quot;&gt;// amount of lines.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    line      &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// line number at the begin of function.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    lastLine  &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// line number at the end of expression&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    numParams &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;                    &lt;span style=&quot;color: #008000&quot;&gt;// number of parameters&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    isVararg  &lt;span style=&quot;color: #267f99&quot;&gt;bool&lt;/span&gt;                   &lt;span style=&quot;color: #008000&quot;&gt;// whether the number of arguments is variable.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="910" y="-138" width="1110" height="338" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-11" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;funcInfo&lt;br&gt;defined in cg_func_info.go" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="380" y="268" width="151" height="30" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-12" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;//FuncProto&lt;br&gt;type&lt;/span&gt; &lt;span style=&quot;color: #267f99&quot;&gt;Prototype&lt;/span&gt; &lt;span style=&quot;color: #0000ff&quot;&gt;struct&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;    Source          &lt;span style=&quot;color: #267f99&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #008000&quot;&gt;// debug&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    LineDefined     &lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    LastLineDefined &lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    NumParams       &lt;span style=&quot;color: #267f99&quot;&gt;byte&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    IsVararg        &lt;span style=&quot;color: #267f99&quot;&gt;byte&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    MaxStackSize    &lt;span style=&quot;color: #267f99&quot;&gt;byte&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    Code            []&lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    Constants       []&lt;span style=&quot;color: #0000ff&quot;&gt;interface&lt;/span&gt;{}&lt;/div&gt;&lt;div&gt;    Upvalues        []Upvalue&lt;/div&gt;&lt;div&gt;    Protos          []*Prototype&lt;/div&gt;&lt;div&gt;    LineInfo        []&lt;span style=&quot;color: #267f99&quot;&gt;uint32&lt;/span&gt; &lt;span style=&quot;color: #008000&quot;&gt;// debug&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    LocVars         []LocVar &lt;span style=&quot;color: #008000&quot;&gt;// debug&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    UpvalueNames    []&lt;span style=&quot;color: #267f99&quot;&gt;string&lt;/span&gt; &lt;span style=&quot;color: #008000&quot;&gt;// debug&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="910" y="357" width="250" height="313" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-13" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color: #267f99&quot;&gt;closure&lt;/span&gt; &lt;span style=&quot;color: #0000ff&quot;&gt;struct&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;    proto  *binchunk.Prototype &lt;span style=&quot;color: #008000&quot;&gt;// lua closure&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    goFunc GoFunction          &lt;span style=&quot;color: #008000&quot;&gt;// go closure&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    upvals []*upvalue&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1160" y="357" width="450" height="103" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-14" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color: #267f99&quot;&gt;upvalInfo&lt;/span&gt; &lt;span style=&quot;color: #0000ff&quot;&gt;struct&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;    locVarSlot &lt;span style=&quot;color: #267f99&quot;&gt;int// index in locVars&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    upvalIndex &lt;span style=&quot;color: #267f99&quot;&gt;int// index in&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    index      &lt;span style=&quot;color: #267f99&quot;&gt;int&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="910" y="206" width="370" height="103" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-15" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color: #267f99&quot;&gt;Upvalue&lt;/span&gt; &lt;span style=&quot;color: #0000ff&quot;&gt;struct&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38 , 127 , 153)&quot;&gt;// funcInfo.locVarSlot&amp;gt;0 means the upvalue is reference to locVar, then the Instack should be 1&lt;/span&gt;&lt;br&gt;Instack &lt;span style=&quot;color: #267f99&quot;&gt;byte&lt;/span&gt;&lt;/div&gt;&lt;div&gt;Idx     &lt;span style=&quot;color: #267f99&quot;&gt;byte//coresponding to upvalue index or locvar index&lt;/span&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1160" y="460" width="460" height="110" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-16" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;func&lt;/span&gt; &lt;span style=&quot;color: #795e26&quot;&gt;toProto&lt;/span&gt;(fi *funcInfo) *Prototype {&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #001080&quot;&gt;proto&lt;/span&gt; := &amp;amp;Prototype{&lt;/div&gt;&lt;div&gt;        LineDefined:     &lt;span style=&quot;color: #795e26&quot;&gt;uint32&lt;/span&gt;(fi.line),&lt;/div&gt;&lt;div&gt;        LastLineDefined: &lt;span style=&quot;color: #795e26&quot;&gt;uint32&lt;/span&gt;(fi.lastLine),&lt;/div&gt;&lt;div&gt;        NumParams:       &lt;span style=&quot;color: #795e26&quot;&gt;byte&lt;/span&gt;(fi.numParams),&lt;/div&gt;&lt;div&gt;        MaxStackSize:    &lt;span style=&quot;color: #795e26&quot;&gt;byte&lt;/span&gt;(fi.maxRegs),&lt;/div&gt;&lt;div&gt;        Code:            fi.insts,&lt;/div&gt;&lt;div&gt;        Constants:       &lt;span style=&quot;color: #795e26&quot;&gt;getConstants&lt;/span&gt;(fi),&lt;/div&gt;&lt;div&gt;        Upvalues:        &lt;span style=&quot;color: #795e26&quot;&gt;getUpvalues&lt;/span&gt;(fi),&lt;/div&gt;&lt;div&gt;        Protos:          &lt;span style=&quot;color: #795e26&quot;&gt;toProtos&lt;/span&gt;(fi.subFuncs),&lt;/div&gt;&lt;div&gt;        LineInfo:        fi.lineNums,&lt;/div&gt;&lt;div&gt;        LocVars:         &lt;span style=&quot;color: #795e26&quot;&gt;getLocVars&lt;/span&gt;(fi),&lt;/div&gt;&lt;div&gt;        UpvalueNames:    &lt;span style=&quot;color: #795e26&quot;&gt;getUpvalueNames&lt;/span&gt;(fi),&lt;/div&gt;&lt;div&gt;    }&lt;/div&gt;&lt;br&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;if&lt;/span&gt; fi.line == &lt;span style=&quot;color: #098658&quot;&gt;0&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #001080&quot;&gt;proto.LastLineDefined&lt;/span&gt; = &lt;span style=&quot;color: #098658&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    }&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;if&lt;/span&gt; proto.MaxStackSize &amp;lt; &lt;span style=&quot;color: #098658&quot;&gt;2&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #001080&quot;&gt;proto.MaxStackSize&lt;/span&gt; = &lt;span style=&quot;color: #098658&quot;&gt;2&lt;/span&gt; &lt;span style=&quot;color: #008000&quot;&gt;// todo&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    }&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;if&lt;/span&gt; fi.isVararg {&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #001080&quot;&gt;proto.IsVararg&lt;/span&gt; = &lt;span style=&quot;color: #098658&quot;&gt;1&lt;/span&gt; &lt;span style=&quot;color: #008000&quot;&gt;// todo&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    }&lt;/div&gt;&lt;br&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;return&lt;/span&gt; proto&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="910" y="670" width="310" height="540" as="geometry" />
        </mxCell>
        <mxCell id="3L58eqj6yo-zojaCWtl0-17" value="&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;func&lt;/span&gt; &lt;span style=&quot;color: #795e26&quot;&gt;getUpvalues&lt;/span&gt;(fi *funcInfo) []Upvalue {&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #001080&quot;&gt;&amp;nbsp; upvals&lt;/span&gt; := &lt;span style=&quot;color: #795e26&quot;&gt;make&lt;/span&gt;([]Upvalue, &lt;span style=&quot;color: #795e26&quot;&gt;len&lt;/span&gt;(fi.upvalues))&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;&amp;nbsp; for&lt;/span&gt; &lt;span style=&quot;color: #001080&quot;&gt;_&lt;/span&gt;, &lt;span style=&quot;color: #001080&quot;&gt;uv&lt;/span&gt; := &lt;span style=&quot;color: #af00db&quot;&gt;range&lt;/span&gt; fi.upvalues {&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px ; border: none ; padding: 0px&quot;&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #af00db&quot;&gt;&amp;nbsp; if&lt;/span&gt; uv.locVarSlot &amp;gt;= &lt;span style=&quot;color: #098658&quot;&gt;0&lt;/span&gt; { &lt;span style=&quot;color: #008000&quot;&gt;// instack&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; upvals[uv.index] = Upvalue{&lt;span style=&quot;color: #098658&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color: #795e26&quot;&gt;byte&lt;/span&gt;(uv.locVarSlot)}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&amp;nbsp; } &lt;span style=&quot;color: #af00db&quot;&gt;else&lt;/span&gt; {&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; upvals[uv.index] = Upvalue{&lt;span style=&quot;color: #098658&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #795e26&quot;&gt;byte&lt;/span&gt;(uv.upvalIndex)}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&amp;nbsp; }&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&quot;background-color: rgb(255 , 255 , 255) ; font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; font-size: 14px ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;droid sans mono&amp;#34; , monospace , monospace , &amp;#34;droid sans fallback&amp;#34; ; line-height: 19px&quot;&gt;&lt;div&gt;&amp;nbsp; }&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #af00db&quot;&gt;&amp;nbsp; return&lt;/span&gt; upvals&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1235" y="670" width="555" height="220" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
